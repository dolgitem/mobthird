import{H as B,ao as F,r,c as d,w as z,o as E,U as H,h as i,J as I,A as O,aa as U,aK as L,g as V,ar as j,aM as A,a5 as D,ap as G}from"./index.3c8f5d62.js";import{T as J}from"./TouchPan.62eac7f9.js";const s=40,T=20;var k=B({name:"QPullToRefresh",props:{color:String,bgColor:String,icon:String,noMouse:Boolean,disable:Boolean,scrollTarget:F},emits:["refresh"],setup(l,{slots:_,emit:C}){const{proxy:m}=V(),{$q:P}=m,t=r("pull"),c=r(0),a=r(!1),f=r(-s),v=r(!1),S=r({}),b=d(()=>({opacity:c.value,transform:`translateY(${f.value}px) rotate(${c.value*360}deg)`})),y=d(()=>"q-pull-to-refresh__puller row flex-center"+(v.value===!0?" q-pull-to-refresh__puller--animating":"")+(l.bgColor!==void 0?` bg-${l.bgColor}`:""));function $(e){if(e.isFinal===!0){a.value===!0&&(a.value=!1,t.value==="pulled"?(t.value="refreshing",g({pos:T}),w()):t.value==="pull"&&g({pos:-s,ratio:0}));return}if(v.value===!0||t.value==="refreshing")return!1;if(e.isFirst===!0){if(j(x)!==0||e.direction!=="down")return a.value===!0&&(a.value=!1,t.value="pull",g({pos:-s,ratio:0})),!1;a.value=!0;const{top:R,left:Q}=p.getBoundingClientRect();S.value={top:R+"px",left:Q+"px",width:window.getComputedStyle(p).getPropertyValue("width")}}A(e.evt);const n=Math.min(140,Math.max(0,e.distance.y));f.value=n-s,c.value=D(n/(T+s),0,1);const u=f.value>T?"pulled":"pull";t.value!==u&&(t.value=u)}const q=d(()=>{const e={down:!0};return l.noMouse!==!0&&(e.mouse=!0),[[J,$,void 0,e]]}),M=d(()=>`q-pull-to-refresh__content${a.value===!0?" no-pointer-events":""}`);function w(){C("refresh",()=>{g({pos:-s,ratio:0},()=>{t.value="pull"})})}let p,x,o=null;function g({pos:e,ratio:n},u){v.value=!0,f.value=e,n!==void 0&&(c.value=n),o!==null&&clearTimeout(o),o=setTimeout(()=>{o=null,v.value=!1,u&&u()},300)}function h(){x=G(p,l.scrollTarget)}return z(()=>l.scrollTarget,h),E(()=>{p=m.$el,h()}),H(()=>{o!==null&&clearTimeout(o)}),Object.assign(m,{trigger:w,updateScrollTarget:h}),()=>{const e=[i("div",{class:M.value},I(_.default)),i("div",{class:"q-pull-to-refresh__puller-container fixed row flex-center no-pointer-events z-top",style:S.value},[i("div",{class:y.value,style:b.value},[t.value!=="refreshing"?i(O,{name:l.icon||P.iconSet.pullToRefresh.icon,color:l.color,size:"32px"}):i(U,{size:"24px",color:l.color})])])];return L("div",{class:"q-pull-to-refresh"},e,"main",l.disable===!1,()=>q.value)}}});export{k as Q};
